<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
    <Package Name="TabScore2"
        Language="1033"
        Version="$(Version)"
        Manufacturer="TabScore2"
        UpgradeCode="D576912E-6999-4523-A8A9-57E8376F1D51"
        Compressed="yes">

        <StandardDirectory Id="ProgramFiles64Folder">
            <Directory Id="INSTALLFOLDER" Name="TabScore2" />
        </StandardDirectory>

        <StandardDirectory Id="ProgramMenuFolder">
            <Directory Id="ApplicationProgramsFolder" Name="TabScore2" />
        </StandardDirectory>

        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
        <MediaTemplate EmbedCab="yes" />

        <Feature Id="ProductFeature" Title="TabScore2" Level="1">
            <ComponentGroupRef Id="ProductComponents" />
            <ComponentRef Id="ApplicationShortcut" />
            <ComponentRef Id="TabScore2Exe" />
        </Feature>

        <!-- The UI reference now points to the fragment below -->
        <UIRef Id="WixUI_Minimal" />

        <!-- An Icon must be defined for an advertised shortcut -->
        <Icon Id="TabScore2.exe" SourceFile="../TabScore2/publish/TabScore2.exe" />


    </Package>

    <Fragment>
        <!-- This placeholder is for the harvested files -->
        <ComponentGroup Id="ProductComponents" />

        <!-- This defines the UI and its required property in a self-contained unit -->
        <UI Id="WixUI_Minimal">
            <UIRef Id="WixUI_Minimal" />
        </UI>
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

        <!-- This component now ONLY contains the per-machine file -->
        <DirectoryRef Id="INSTALLFOLDER">
            <Component Id="TabScore2Exe" Guid="F9B94A53-B386-435E-9694-8461521C26D1"
                Bitness="always64">
                <File Id="TabScore2.exe"
                    Source="../TabScore2/publish/TabScore2.exe"
                    KeyPath="yes" />
            </Component>
        </DirectoryRef>

        <!-- This component now handles the advertised shortcut and the Start Menu folder -->
        <DirectoryRef Id="ApplicationProgramsFolder">
            <Component Id="ApplicationShortcut" Guid="E6B5A4F7-3A4A-4B9A-B06F-420551826A9A"
                Bitness="always64" KeyPath="yes">
                <Shortcut Id="ApplicationStartMenuShortcut"
                    Name="TabScore2"
                    Description="TabScore2"
                    Advertise="yes"
                    Icon="TabScore2.exe"
                    WorkingDirectory="INSTALLFOLDER" />
                <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
                <!-- The CreateFolder element ensures the directory is created, but is not the
                KeyPath -->
                <CreateFolder />
            </Component>
        </DirectoryRef>

        <!-- This NEW component ONLY handles the per-user registry key -->
        <Component Id="ApplicationRegistry" Guid="3E45228E-8E7B-4A1C-8A7B-3E838F5F2C5A"
            Bitness="always64">
            <RegistryValue Root="HKCU" Key="Software\TabScore2" Name="installed" Type="integer"
                Value="1" KeyPath="yes" />
        </Component>

    </Fragment>

</Wix>
  
  
